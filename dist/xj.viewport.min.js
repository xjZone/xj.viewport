/** xj.viewport(视窗属性设置) | V0.3.0 | Apache Licence 2.0 | 2015-2021 © XJ.Chen | https://github.com/xjZone/xj.viewport */
!function(a,b){"function"!=typeof define||void 0===define.amd&&void 0===define.cmd?"undefined"!=typeof module&&"object"==typeof exports?module.exports=b():(a=a||self,a.xj||(a.xj={}),a.xj.viewport=b()):define(b)}(this,function(){"use strict";var g,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof self?self:global,c="0.3.0",e={manual:!1,betkbd:240},f={minWidth:0,minHeight:0,onlyMobile:!0,fillScreen:!1,delayReset:500,initialScale:"auto",minimumScale:"none",maximumScale:"none",userScalable:"none",targetDensitydpi:"",viewportFit:"",resize:!0,width:"auto",height:"auto"};return void 0===a.xj&&(a.xj={}),void 0===a.xj.viewportReturn&&(a.xj.viewportReturn={}),void 0!==a.xj.viewportReturn[c]?a.xj.viewportReturn[c]:(void 0===a.xj.viewportConfig&&(a.xj.viewportConfig={}),void 0===a.xj.viewportOption&&(a.xj.viewportOption={}),void 0!==a.xj.viewportConfig[c]&&Object.keys(a.xj.viewportConfig[c]).forEach(function(b){e[b]=a.xj.viewportConfig[c][b]}),void 0!==a.xj.viewportOption[c]&&Object.keys(a.xj.viewportOption[c]).forEach(function(b){f[b]=a.xj.viewportOption[c][b]}),g=a,h=g.document,i=h.documentElement,h.body,k=h.querySelector('meta[name="viewport"]'),l=/Mobile|Android|iPhone|iPad/i.test(navigator.userAgent),m=l===!0&&/Apple/i.test(navigator.vendor)===!0?!0:!1,n=function(){k.setAttribute("content","width=device-width,initial-scale=1")},o=function(){return l===!1?g.innerWidth>g.innerHeight?"landscape":g.innerWidth<g.innerHeight?"portrait":"squared":m===!0?i.clientWidth>i.clientHeight?"landscape":i.clientWidth<i.clientHeight?"portrait":"squared":screen.width>screen.height?"landscape":screen.width<screen.height?"portrait":"squared"},p=/Firefox/i.test(navigator.userAgent)===!0?"MozUserModify":"webkitUserModify",q=function(a,b){return g.getComputedStyle(a,b?b:null)},r=function(a){return/^input|textarea$/i.test(a.nodeName)===!0?!1:a.isContentEditable===!0||void 0===h.documentMode&&/write/i.test(q(a)[p])===!0?!0:!1},s=function(){return parseFloat(k.content.match(/initial-scale=([^,]+)/i)[1].trim())},t=!0,function(a,b){try{a=h.createElement("input"),a.type="color",a.value="!",b="color"===a.type&&"!"!==a.value}catch(c){}b===!1&&(t=!1)}(null,!1),u=function(){if(l===!1||m===!0)return!1;var a=h.activeElement;if(null===a||1!==a.nodeType)return!1;if(/^input|textarea$/i.test(a.nodeName)===!0){if(/color/i.test(a.type)===!0&&t===!0)return!1;if(/textarea|text|email|tel|url|number|search|password|date|time|week|month|range|color/i.test(a.type)===!1)return!1;if(a.readOnly===!0||a.disabled===!0||a.hasAttribute("readOnly")===!0||a.hasAttribute("disabled")===!0)return!1}return r(a)===!1?!1:screen.height-v.height()*s()<e.betkbd?!1:!0},v={version:c,element:k,orientation:o,softKeyboard:u,width:function(){return Math.round(i.clientWidth)},height:function(){return Math.round(g.innerHeight/g.innerWidth*i.clientWidth)},get:function(){return k.getAttribute("content")},set:function(a){var c,d,e,h,i,j,p,q,r,s,t,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,b={};Object.keys(f).forEach(function(a){b[a]=f[a]}),null!==a&&"object"==typeof a&&Object.keys(a).forEach(function(c){b[c]=a[c]}),c=b.minWidth,d=b.minHeight,e=b.onlyMobile,h=b.fillScreen,i=b.delayReset,j=b.initialScale,p=b.minimumScale,q=b.maximumScale,r=b.userScalable,s=b.targetDensitydpi,t=b.viewportFit,w=b.resize,x=b.width,y=b.height,(l!==!1||e!==!0)&&(z=v.width(),A=v.height(),B="",C="",D=1,E=1,F=1,"auto"===x&&(0!==c&&0===d&&c>z?(C=c,D=z/c):0===c&&0!==d&&d>A?(C=Math.round(d/A*z),D=A/d):0!==c&&0!==d&&(c>z||d>A?(c>z&&(E=z/c),d>A&&(F=A/d)):h===!0&&(z>c&&(E=z/c),A>d&&(F=A/d)),(1!==E||1!==F)&&(C=F>=E?c:Math.round(d/A*z),D=Math.min(E,F)))),B="width=",B+="auto"!==x?x:""===C?"device-width":C,B+=",initial-scale="+("auto"===j?D:initialScale),"none"!==p&&(B+=",minimum-scale="+("auto"===p?D:p)),"none"!==q&&(B+=",maximum-scale="+("auto"===q?D:q)),"none"!==r&&(B+=",user-scalable="+r),"auto"!==y&&(B+=",height="+y),""!==t&&(B+=",viewport-fit="+t),""!==s&&(B+=",target-densitydpi="+s),k.setAttribute("content",B),w!==!1&&(G=v.height(),H=0/0,I=o(),J=0,K=void 0,L=!1,g.addEventListener("resize",function(){return l===!1?(n(),b.resize=!1,v.set(b),void 0):((m!==!1||L!==!0)&&(m!==!1||u()!==!0)&&(clearTimeout(K),K=setTimeout(function(){H=v.height(),J=o(),J===I&&H+4>=G||(J!==I||G>H+4)&&(m===!1&&(L=!0),n(),L=!1,b.resize=!1,v.set(b),g.dispatchEvent(new Event("resize",{bubbles:!0,cancelable:!0})),G=v.height(),I=J)},i)),void 0)},!0)))}},e.manual===!1&&k.hasAttribute("xj-viewport")&&(w=eval("("+k.getAttribute("xj-viewport")+")"),void 0!==w&&null!==w&&"object"==typeof w&&v.set(w)),a.xj.viewportReturn[c]=v)});
